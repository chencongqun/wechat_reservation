
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<meta name="format-detection" content="telephone=no" />
<title>我的订单</title>
<link rel="stylesheet" type="text/css" href="http://imgcache.life.qq.com/www/misc/styles/wei_shopwaimai.css?v=1.0.10" />
<link rel="stylesheet" type="text/css" href="http://imgcache.life.qq.com/www/misc/styles/wei_dialog.css?v=1.0.1" />
<script src="http://imgcache.life.qq.com/www/misc/scripts/wei_webapp_v2_common.js?v=1.0.5"></script>
<script src="http://imgcache.life.qq.com/www/misc/scripts/wei_dialog.js?v=1.0.0"></script>
</head>
<body id="myOrder">
        <dl class="myOrderDl">
            <dt class="orderState">2014-09-22 15:24<em></em><i>订单状态：<span >
        已拒绝
        </span></i></dt>
            <dd class="orderMenu"><span class="topjiao"></span>
                <p><label>配送时间：</label><b class="sendnow">2014-10-07&nbsp;&nbsp;立即配送</b></p>
                <p><label>联系电话：</label>18611111111</p>
                <p class="box"><label>详细地址：</label>南山</p>
                                <p class="zongjia"><label>总&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计：</label><span>81</span>元（含配送费10元）</p>
                <dl>
                                        <dd><span class="fr"><span class="danjia">71元</span></span><b>忆江南订购价</b><i>X1</i> </dd>
                                    </dl>
                <!--a href="http://life.qq.com/weixin/1337029146/showDishOrder?orderId=1409221272887019&ticket=0153be319756c0c7846471319a85fef9">订单页</a-->
            </dd>
        </dl>
        <dl class="myOrderDl">
            <dt class="orderState">2014-09-09 17:07<em></em><i>订单状态：<span >
        已拒绝
        </span></i></dt>
            <dd class="orderMenu"><span class="topjiao"></span>
                <p><label>配送时间：</label><b class="sendnow">2014-10-07&nbsp;&nbsp;立即配送</b></p>
                <p><label>联系电话：</label>18611111111</p>
                <p class="box"><label>详细地址：</label>南山</p>
                                <p class="zongjia"><label>总&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计：</label><span>2567</span>元（含配送费10元）</p>
                <dl>
                                        <dd><span class="fr"><span class="danjia">640元</span></span><b>典膳坊老月饼订购价</b><i>X8</i> </dd>
                                        <dd><span class="fr"><span class="danjia">994元</span></span><b>苏之味订购价</b><i>X7</i> </dd>
                                        <dd><span class="fr"><span class="danjia">923元</span></span><b>忆江南订购价</b><i>X13</i> </dd>
                                    </dl>
                <!--a href="http://life.qq.com/weixin/1337029146/showDishOrder?orderId=1409093077362486&ticket=0153be319756c0c7846471319a85fef9">订单页</a-->
            </dd>
        </dl>
        <dl class="myOrderDl">
            <dt class="orderState">2014-07-04 18:25<em></em><i>订单状态：<span >
        已拒绝
        </span></i></dt>
            <dd class="orderMenu"><span class="topjiao"></span>
                <p><label>配送时间：</label><b class="sendnow">2014-10-07&nbsp;&nbsp;立即配送</b></p>
                <p><label>联系电话：</label>18611111111</p>
                <p class="box"><label>详细地址：</label>南山</p>
                                <p class="zongjia"><label>总&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计：</label><span>1671</span>元（免配送费）</p>
                <dl>
                                        <dd><span class="fr"><span class="danjia">698元</span></span><b>天相园套餐10人A</b><i>X1</i> </dd>
                                        <dd><span class="fr"><span class="danjia">464元</span></span><b>汨罗香韵</b><i>X2</i> </dd>
                                        <dd><span class="fr"><span class="danjia">426元</span></span><b>汨罗如意</b><i>X3</i> </dd>
                                        <dd><span class="fr"><span class="danjia">83元</span></span><b>飘香端午粽</b><i>X1</i> </dd>
                                    </dl>
                <!--a href="http://life.qq.com/weixin/1337029146/showDishOrder?orderId=1407041040332050&ticket=0153be319756c0c7846471319a85fef9">订单页</a-->
            </dd>
        </dl>
        <dl class="myOrderDl">
            <dt class="orderState">2014-07-04 18:12<em></em><i>订单状态：<span >
        已拒绝
        </span></i></dt>
            <dd class="orderMenu"><span class="topjiao"></span>
                <p><label>配送时间：</label><b class="sendnow">2014-10-07&nbsp;&nbsp;立即配送</b></p>
                <p><label>联系电话：</label>18611111111</p>
                <p class="box"><label>详细地址：</label>南山</p>
                                <p class="zongjia"><label>总&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计：</label><span>698</span>元（免配送费）</p>
                <dl>
                                        <dd><span class="fr"><span class="danjia">698元</span></span><b>天相园套餐10人A</b><i>X1</i> </dd>
                                    </dl>
                <!--a href="http://life.qq.com/weixin/1337029146/showDishOrder?orderId=1407042364757473&ticket=0153be319756c0c7846471319a85fef9">订单页</a-->
            </dd>
        </dl>
    <script>
window.shareData = {"appid":"wxf5f814b9aed14c8a","imgUrl":"http:\/\/imgcache.life.qq.com\/www\/misc\/images\/weixin_shop_logo\/1337029146_share_150_150.png","timeLineLink":"http:\/\/life.qq.com\/qr\/t13874434192865#wechat_redirect","tTitle":"\u5173\u6ce8\u53ef\u83b7\u5f97\u300c\u6c5f\u5357\u9910\u996e\u96c6\u56e2\u300d\u5fae\u751f\u6d3b\u4f1a\u5458\u5361","tContent":"\u6c5f\u5357\u9910\u996e\u96c6\u56e2","sendFriendLink":"http:\/\/life.qq.com\/qr\/f13874434195897#wechat_redirect","fTitle":"\u6c5f\u5357\u9910\u996e\u96c6\u56e2","fContent":"\u5173\u6ce8\u53ef\u83b7\u5f97\u300c\u6c5f\u5357\u9910\u996e\u96c6\u56e2\u300d\u5fae\u751f\u6d3b\u4f1a\u5458\u5361","wContent":"#\u5fae\u4fe1\u626b\u63cf\u4e8c\u7ef4\u7801#\u6211\u521a\u5728\u6c5f\u5357\u9910\u996e\u96c6\u56e2\u626b\u63cf\u4e8c\u7ef4\u7801\uff0c\u8f7b\u677e\u83b7\u5f97\u5fae\u751f\u6d3b\u4f1a\u5458\u5361\uff0c\u5f97\u52301337029146\uff0c\u9177\u70ab\u53c8\u597d\u73a9\uff01","wLink":null};
var ticket = '0153be319756c0c7846471319a85fef9',
    code = '0153be319756c0c7846471319a85fef9',
    ticketSource = '',
    wticket = '',
    qrcode = 'q13884599648962';

    var pageName = pageName ? pageName : '';


// 分享
function shareFriend(appid, imgUrl, sendFriendLink, fContent, fTitle) {
    WeixinJSBridge.invoke('sendAppMessage',{
                            "appid":appid,
                            "img_url":imgUrl,
                            "img_width":"640",
                            "img_height":"640",
                            "link":sendFriendLink,
                            "desc":fContent,
                            "title":fTitle
                            }, function(res) {
                            _report('send_msg', res.err_msg);
                            })
}
function shareTimeline(imgUrl, timeLineLink, tContent, tTitle) {
    WeixinJSBridge.invoke('shareTimeline',{
                            "img_url":imgUrl,
                            "img_width":"640",
                            "img_height":"640",
                            "link":timeLineLink,
                            "desc": tContent,
                            "title": tTitle
                            }, function(res) {
                            _report('timeline', res.err_msg);
                            });
}
function shareWeibo(wContent, wLink) {
    WeixinJSBridge.invoke('shareWeibo',{
                            "content":wContent,
                            "url":wLink,
                            }, function(res) {
                            _report('weibo', res.err_msg);
                            });
}
// 当微信内置浏览器完成内部初始化后会触发WeixinJSBridgeReady事件。
document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {

        // 发送给好友
        WeixinJSBridge.on('menu:share:appmessage', function(argv){
            if (pageName == 'menuFilled') {

                var params = {
                    'qrcode' : qrcode,
                    'ticket' : ticket,
                    'ticketSource' : ticketSource
                };

                MLoading.show('加载中');
                setTimeout(function(){MLoading.hide();},3000);
                _doAjax('/weixin/dish/share', 'POST', params, function(ret){
                    MLoading.hide();
                    if (ret['code'] != 0) {
                        alert(ret['message']);
                        return;
                    }
                    var result = ret['result']['data'];

                    shareFriend(result.appid, result.img_url, result.link, result.desc, result.title);
                });

            } else {
                shareFriend(window.shareData.appid, window.shareData.imgUrl, window.shareData.sendFriendLink, window.shareData.fContent, window.shareData.fTitle);
            }
        });

        // 分享到朋友圈
        WeixinJSBridge.on('menu:share:timeline', function(argv){
            if (pageName == 'menuFilled') {

                var params = {
                    'qrcode' : qrcode,
                    'ticket' : ticket,
                    'ticketSource' : ticketSource
                };

                MLoading.show('加载中');
                setTimeout(function(){MLoading.hide();},3000);
                _doAjax('/weixin/dish/share', 'POST', params, function(ret){
                    MLoading.hide();
                    if (ret['code'] != 0) {
                        alert(ret['message']);
                        return;
                    }
                    var result = ret['result']['data'];

                    shareTimeline(result.img_url, result.link, result.desc, result.title);
                });

            } else {

                shareTimeline(window.shareData.imgUrl, window.shareData.timeLineLink, window.shareData.tContent, window.shareData.tTitle);
            }
        });

        // 分享到微博
        WeixinJSBridge.on('menu:share:weibo', function(argv){
            if (pageName == 'menuFilled') {

                var params = {
                    'qrcode' : qrcode,
                    'ticket' : ticket,
                    'ticketSource' : ticketSource
                };

                MLoading.show('加载中');
                setTimeout(function(){MLoading.hide();},3000);
                _doAjax('/weixin/dish/share', 'POST', params, function(ret){
                    MLoading.hide();
                    if (ret['code'] != 0) {
                        alert(ret['message']);
                        return;
                    }
                    var result = ret['result']['data'];

                    shareWeibo(result.title, result.link);
                });

            } else {

                shareWeibo(window.shareData.wContent, window.shareData.wLink);
            }
        });
     }, false)


     function placeOrder(orderId, cardid) {

        params = {
            'ticket' : ticket,
            ticketSource : ticketSource,
            action : 'placeOrder',
            orderId : orderId,
            code : code,
            qrcode : qrcode
        };

        MLoading.show('加载中');
        setTimeout(function(){MLoading.hide();},3000);
        _doAjax('/weixin/'+cardid+'/showDishOrder', 'POST', params, function(ret) {
            MLoading.hide();
            if (ret['code'] == 100) {
                location.href = location.origin + '/weixin/'+cardid+'/dishWaimaiCardPay?action=payByCard&ticket=' + ticket + '&qrcode=' + qrcode + '&orderId='+orderId+'#wechat_webview_type=1';
            } else if (ret['code'] != 0) {
                alert(ret['message']);
                return;
            }

            isWeixin5=1;
            // 微信支付
            if (isWeixin5) {
                    var weixinPay = ret.result.weixinPay;
                    var requestData = {};
                    requestData.appId = weixinPay.appId; //公众号名称,由商户传入
                    requestData.timeStamp = weixinPay.timeStamp + ''; //时间戳 这里随意使用了一个值
                    requestData.nonceStr = weixinPay.nonceStr; //随机串
                    requestData.package = weixinPay.package; // 扩展字段,由商户传入
                    requestData.signType = weixinPay.signType; //微信签名方式:sha1
                    requestData.paySign = weixinPay.paySign; //微信签名
                    // 下单成功 => 微信支付
                    WeixinJSBridge.invoke('getBrandWCPayRequest', requestData, function(d){
                                          // 支付回调
                                          // alert(d.err_msg);
                                          if (d.err_msg == 'get_brand_wcpay_request:ok') {
                                               location.href = location.origin + '/weixin/'+cardid+'/listDishOrder?ticket=' + ticket + '&qrcode=' + qrcode + '&code=' + code + '#wechat_webview_type=1';
                                            // 支付成功
                                          } else if(d.err_msg == 'get_brand_wcpay_request:cancel') {
                                            // 取消支付
                                          } else {
                                            // 支付失败
                                          }
                                      });

            }
        });
     }

</script><script>
var ticket = '0153be319756c0c7846471319a85fef9';
var ticketSource = '';
var cardid = '1337029146';


    var payBtns = _qAll('.weixinPay'), i=0;
    for(i;i<payBtns.length;i++) {
        payBtns[i].onclick = function(event){
            var orderId = this.getAttribute('orderId');
            placeOrder(orderId, cardid);
            return false;
        }
    }


</script>
</body>
</html>